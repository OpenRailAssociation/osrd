-- This file should undo anything in `up.sql`


CREATE TABLE pathfinding (
	id int8 PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	"owner" uuid NOT NULL,
	created timestamptz NOT NULL,
	payload jsonb NOT NULL,
	slopes jsonb NOT NULL,
	curves jsonb NOT NULL,
	geographic geometry(linestring, 4326) NOT NULL,
	schematic geometry(linestring, 4326) NOT NULL,
	infra_id int8 NOT NULL,
	length float8 NOT NULL,
	CONSTRAINT pathfinding_fkey FOREIGN KEY (infra_id) REFERENCES infra(id) ON DELETE CASCADE
);

CREATE TABLE timetable (
	id int8 PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	name varchar(128) NOT NULL
);

CREATE TABLE scenario (
	id int8 PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	name varchar(128) NOT NULL,
	description varchar(1024) NOT NULL,
	creation_date timestamptz NOT NULL,
	last_modification timestamptz NOT NULL,
	tags text[] NOT NULL,
	infra_id int8 NOT NULL REFERENCES infra(id) ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED,
	timetable_id int8 NOT NULL UNIQUE REFERENCES timetable(id) DEFERRABLE INITIALLY DEFERRED,
	study_id int8 NOT NULL REFERENCES study(id) ON DELETE CASCADE,
	electrical_profile_set_id int8 NULL REFERENCES electrical_profile_set(id) ON DELETE CASCADE
);
CREATE INDEX scenario_infra_id ON scenario USING btree (infra_id);

CREATE TABLE simulation_output (
	id int8 PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	mrsp jsonb NOT NULL,
	base_simulation jsonb NOT NULL,
	eco_simulation jsonb NULL,
	electrification_ranges jsonb NOT NULL,
	train_schedule_id int8 NULL UNIQUE REFERENCES train_schedule(id) ON DELETE CASCADE,
	power_restriction_ranges jsonb NOT NULL
);
