openapi: 3.0.0
info:
  title: OSRD
  description: OSRD middleware api description
  version: 2.0.0
tags:
  - name: infra
    description: Infra
  - name: rolling_stock
    description: Rolling Stock
  - name: timetable
    description: Timetable
  - name: train_schedule
    description: Train Schedule
  - name: pathfinding
    description: Pathfinding
  - name: stdcm
    description: Short term DCM

paths:
  /health/:
    get:
      responses:
        200:
          description: Check if Editoast is running correctly

  /infra/:
    get:
      deprecated: true
      tags:
        - infra
      summary: List all available infra
      responses:
        200:
          description: The infra list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/Infra"
  /version/api/:
    get:
      responses:
        200:
          description: Return the api service version
          content:
            application/json:
              schema:
                type: object
                properties:
                  git_describe:
                    type: string
                    nullable: true
                required:
                  - git_describe
  /version/core/:
    get:
      responses:
        200:
          description: Return the core service version
          content:
            application/json:
              schema:
                type: object
                properties:
                  git_describe:
                    type: string
                    nullable: true
                required:
                  - git_describe

  /infra/{id}/:
    get:
      deprecated: true
      tags:
        - infra
      summary: Retrieve an infra
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Infra ID
          required: true
      responses:
        200:
          description: The infra information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Infra"

  /infra/railjson/:
    post:
      deprecated: true
      tags:
        - infra
      summary: Import an infra from railjson
      requestBody:
        description: Railjson infra
        content:
          application/json:
            schema:
              type: object
              example:
                version: 3.0.1
                operational_points: []
                routes: []
                switch_types: []
                switches: []
                track_section_links: []
                track_sections: []
                signals: []
                buffer_stops: []
                speed_sections: []
                catenaries: []
                detectors: []
        required: true
      responses:
        201:
          description: The imported infra id
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: string }
  /infra/{id}/railjson/:
    get:
      deprecated: true
      tags:
        - infra
      summary: Serialize an infra to railjson
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Infra ID
          required: true
        - in: query
          name: exclude_extensions
          schema:
            type: boolean
            default: false
          description: Whether the railjson should contain extensions
      responses:
        200:
          description: The infra in railjson format
          content:
            application/json:
              schema:
                type: object
                description: Follows railjson format
                example:
                  version: 2.0.0
                  operational_points: []
                  routes: []
                  switch_types: []
                  switches: []
                  track_section_links: []
                  track_sections: []
                  signals: []
                  buffer_stops: []
                  detectors: []
                  tvd_sections: []
                  script_functions: []
                  aspects: []
  /pathfinding/:
    post:
      tags:
        - pathfinding
      summary: Create a Path
      requestBody:
        description: Steps of the path
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PathQuery"
      responses:
        201:
          description: The path
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Path"
  /pathfinding/op/:
    post:
      tags:
        - pathfinding
      summary: |
        Create a Path given a list of operational points trigram.
        Note: This endpoint is used for a proof of concept and shouldn't be used in production.
      requestBody:
        description: Steps of the path
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PathOPQuery"
      responses:
        201:
          description: The path
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Path"
  /pathfinding/{id}/:
    get:
      tags:
        - pathfinding
      summary: Retrieve a Path
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Path ID
          required: true
      responses:
        200:
          description: The path
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Path"
    put:
      tags:
        - pathfinding
      summary: Update a path
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Path ID
          required: true
      requestBody:
        description: Steps of the path
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PathQuery"
      responses:
        200:
          description: The path
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Path"
    delete:
      tags:
        - pathfinding
      summary: Delete a path
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Path ID
          required: true
      responses:
        204:
          description: No content
  /rolling_stock/:
    get:
      tags:
        - rolling_stock
      summary: Paginated list of rolling stock
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            maximum: 10000
            minimum: 1
            default: 100
          description: Number of elements by page
      responses:
        200:
          description: The rolling stock list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/RollingStock"
    post:
      tags:
        - rolling_stock
      summary: Create a rolling stock
      responses:
        200:
          description: The rolling stock list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RollingStock"
  /rolling_stock/{id}/:
    get:
      tags:
        - rolling_stock
      summary: Retrieve a rolling stock
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Rolling Stock ID
          required: true
      responses:
        200:
          description: The rolling stock information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RollingStock"
  /rolling_stock/{id}/livery/:
    get:
      tags:
        - rolling_stock
        - livery
      summary: Retrieve the compound image of a rolling stock livery
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Rolling Stock ID
          required: true
        - in: query
          name: livery_id
          schema:
            type: integer
          description: Rolling Stock Livery ID
          required: true
      responses:
        200:
          description: The livery compound image
          content:
            image/png:
              schema:
                type: string
                format: binary
  /rolling_stock_livery/:
    post:
      tags:
        - rolling_stock
        - livery
      summary: Create a rolling stock livery
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                rolling_stock_id:
                  type: number
                images:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        200:
          description: The rolling stock livery
          content:
            image/png:
              schema:
                type: string
                format: binary
  /light_rolling_stock/:
    get:
      tags:
        - rolling_stock
      summary: Paginated list of rolling stock with a lighter response
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            maximum: 10000
            minimum: 1
            default: 100
          description: Number of elements by page
      responses:
        200:
          description: The rolling stock list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/LightRollingStock"
  /light_rolling_stock/{id}/:
    get:
      tags:
        - rolling_stock
      summary: Retrieve a rolling stock's light representation
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Rolling Stock ID
          required: true
      responses:
        200:
          description: The rolling stock without effort curves nor rolling resistance
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LightRollingStock"
  /timetable/:
    get:
      tags:
        - timetable
      summary: Paginated list of timetable
      parameters:
        - in: query
          name: infra
          schema:
            type: integer
          description: Filter timetable by infra
        - in: query
          name: page
          schema:
            type: integer
            minimum: 0
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            maximum: 10000
            minimum: 1
            default: 100
          description: Number of elements by page
      responses:
        200:
          description: The timetable list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        name:
                          type: string
                        infra:
                          type: number
    post:
      tags:
        - timetable
      summary: Create a timetable
      requestBody:
        description: Infrastructure id and waypoints
        content:
          application/json:
            schema:
              type: object
              properties:
                infra:
                  type: number
                electrical_profile_set:
                  type: number
                  nullable: true
                  description: Electrical profile set id (if any)
                name:
                  type: string
              required:
                - infra
                - name
      responses:
        201:
          description: The timetable created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  name:
                    type: string
                  infra:
                    type: number
                  electrical_profile_set:
                    type: number
                    nullable: true
  /timetable/{id}/:
    get:
      tags:
        - timetable
      summary: Retrieve a timetable and its train schedules
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Timetable ID
          required: true
      responses:
        200:
          description: The timetable content
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  name:
                    type: string
                  infra:
                    type: number
                  electrical_profile_set:
                    type: number
                    nullable: true
                  train_schedule:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: number
                        train_name:
                          type: string
                        departure_time:
                          type: number
                        train_path:
                          type: number
    delete:
      tags:
        - timetable
      summary: Delete a timetable and its train schedules
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Timetable ID
          required: true
      responses:
        204:
          description: No content
    put:
      tags:
        - timetable
      summary: Update a timetable
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Timetable ID
          required: true
      requestBody:
        description: Infrastructure id and waypoints
        content:
          application/json:
            schema:
              type: object
              properties:
                infra:
                  type: number
                name:
                  type: string
                electrical_profile_set:
                  type: number
                  nullable: true
              required:
                - infra
                - name
      responses:
        200:
          description: The timetable updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  name:
                    type: string
                  infra:
                    type: number
  /train_schedule/standalone_simulation/:
    post:
      tags:
        - train_schedule
      summary: Create a batch of train schedule and run simulations accordingly
      requestBody:
        description: Standalone simulation parameters
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StandaloneSimulationParameters"
        required: true
      responses:
        201:
          description: The ids of the train_schedules created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ids:
                    type: array
                    minItems: 1
                    items:
                      type: number
                      format: integer
  /train_schedule/{id}/:
    get:
      tags:
        - train_schedule
      summary: Retrieve a train schedule
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Train schedule ID
          required: true
      responses:
        200:
          description: The train schedule info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrainSchedule"
    delete:
      tags:
        - train_schedule
      summary: Delete a train schedule and its result
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Train schedule ID
          required: true
      responses:
        204:
          description: No content
    patch:
      tags:
        - train_schedule
      summary: Update a train_schedule and run a simulation accordingly
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Train schedule ID
          required: true
      requestBody:
        description: Train schedule fields
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WritableTrainSchedule"
        required: true
      responses:
        200:
          description: The train schedule info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrainSchedule"
  /train_schedule/{id}/result/:
    get:
      tags:
        - train_schedule
      summary: Retrieve a simulation result
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Train schedule ID
          required: true
        - in: query
          name: path
          schema:
            type: integer
          description: Path id used to project the train path
      responses:
        200:
          description: The train schedule result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TrainScheduleResult"
  /train_schedule/results/:
    get:
      tags:
        - train_schedule
      summary: Retrieve the simulation result of multiple train schedules
      parameters:
        - in: query
          name: path
          schema:
            type: integer
          description: Path id used to project the train path
        - in: query
          name: train_ids
          schema:
            type: array
            uniqueItems: true
            minItems: 1
            items:
              type: integer
          description: List of train schedule ids
          required: true
      responses:
        200:
          description: The train schedules results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TrainScheduleResult"
  /infra/{id}/speed_limit_tags/:
    get:
      deprecated: true
      tags:
        - infra
      summary: List all speed limit tags
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Infra ID
          required: true
      responses:
        200:
          description: Tags list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example: ["freight", "heavy_load"]
  /infra/{id}/voltages/:
    get:
      deprecated: true
      tags:
        - infra
      summary: List all voltages
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          description: Infra ID
          required: true
      responses:
        200:
          description: Voltages list
          content:
            application/json:
              schema:
                type: array
                items:
                  type: number
                  format: float
                example: [750.0, 1500.0, 2500.50]
  /infra/schema/:
    get:
      tags:
        - infra
      summary: Current railjson schema
      responses:
        200:
          description: Json schema
          content:
            application/json:
              schema:
                type: object
                description: Railjson schema following json Schema specification
                example:
                  title: RailJsonInfra
                  type: object
                  properties: { ... }
                  required: [...]
                  definitions: { ... }
  /stdcm/:
    post:
      tags:
        - stdcm
      summary: Find a stdcm and return a simulation result
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/STDCMRequest"
      responses:
        200:
          description: Simulation result
          content:
            application/json:
              schema:
                oneOf:
                  - properties:
                      simulation:
                        $ref: "#/components/schemas/TrainScheduleResult"
                      path:
                        $ref: "#/components/schemas/Path"
                  - type: object
                    properties:
                      error:
                        type: string
                        description: Error message
                        example: No path could be found
        400:
          description: The request body is invalid

  /projects/:
    post:
      tags:
        - projects
      summary: Create a new project
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectRequest"
      responses:
        201:
          description: The created project
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResult"
    get:
      tags:
        - projects
      summary: Paginated list of projects
      parameters:
        - in: query
          name: ordering
          schema:
            type: string
            enum:
              [
                "name",
                "-name",
                "creation_date",
                "-creation_date",
                "last_modification",
                "-last_modification",
              ]
        - in: query
          name: name
          schema:
            type: string
          description: Filter projects by name
        - in: query
          name: description
          schema:
            type: string
          description: Filter projects by description
        - in: query
          name: tags
          schema:
            type: string
          description: Filter projects by tags
        - in: query
          name: page
          schema:
            type: integer
            minimum: 0
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            maximum: 10000
            minimum: 1
            default: 100
          description: Number of elements by page
      responses:
        200:
          description: the project list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        schema:
                          $ref: "#/components/schemas/ProjectResult"

  /projects/{project_id}/:
    get:
      tags:
        - projects
      summary: Retrieve a project
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id you want to retrieve
          required: true
      responses:
        200:
          description: The project info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResult"
    patch:
      tags:
        - projects
      summary: Update a project
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id you want to update
          required: true
      requestBody:
        description: The fields you want to update
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectRequest"
      responses:
        200:
          description: The project updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResult"
    delete:
      tags:
        - projects
      summary: delete a project
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id you want to delete
          required: true
      responses:
        204:
          description: No content

  /projects/{project_id}/image/:
    get:
      tags:
        - projects
      summary: Retrieve a project image
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id you want to retrieve the image
          required: true
      responses:
        200:
          description: The project image
          content:
            image/png:
              schema:
                type: string
                format: binary

  /projects/{project_id}/studies/:
    post:
      tags:
        - studies
      summary: Create a new operational study
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StudyRequest"
      responses:
        201:
          description: The created operational study
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StudyResult"
    get:
      tags:
        - studies
      summary: Paginated list of operational studies
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          required: true
        - in: query
          name: name
          schema:
            type: string
          description: Filter operational studies by name
        - in: query
          name: description
          schema:
            type: string
          description: Filter operational studies by description
        - in: query
          name: tags
          schema:
            type: string
          description: Filter operational studies by tags
        - in: query
          name: page
          schema:
            type: integer
            minimum: 0
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            maximum: 10000
            minimum: 1
            default: 100
          description: Number of elements by page
      responses:
        200:
          description: the studies list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        schema:
                          $ref: "#/components/schemas/StudyResult"

  /projects/{project_id}/studies/{study_id}/:
    get:
      tags:
        - studies
      summary: Retrieve an operational study
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the operational study
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
          description: study id you want to retrieve
      responses:
        200:
          description: The operational study info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StudyResult"
    patch:
      tags:
        - studies
      summary: update an operational study
      parameters:
        - in: query
          name: project_id
          schema:
            type: integer
          description: project id refered to the study
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
          description: study id you want to retrieve
      requestBody:
        description: The fields you want to update
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StudyRequest"
      responses:
        200:
          description: The operational study updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StudyResult"
    delete:
      tags:
        - studies
      summary: delete an operational study
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the operational study
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
          description: study id you want to delete
      responses:
        204:
          description: No content
  /projects/{project_id}/study_types/:
    get:
      tags:
        - studies
      summary: Retrieve list of study types
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the operational study
          required: true
      responses:
        200:
          description: The list of study types
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example:
                  [
                    "timeTables",
                    "flowRate",
                    "parkSizing",
                    "garageRequirement",
                    "operationOrSizing",
                    "operability",
                    "strategicPlanning",
                    "chartStability",
                    "disturbanceTests",
                  ]
  /projects/{project_id}/study_states/:
    get:
      tags:
        - studies
      summary: Retrieve list of study states
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the operational study
          required: true
      responses:
        200:
          description: The list of study states
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example: ["started", "inProgress", "finish"]
  /projects/{project_id}/studies/{study_id}/scenarios/:
    post:
      tags:
        - scenarios
      summary: Create a new scenario
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScenarioRequest"
      responses:
        201:
          description: The created scenario
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScenarioResult"
    get:
      tags:
        - scenarios
      summary: Paginated list of scenarios
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
        - in: query
          name: name
          schema:
            type: string
          description: Filter scenarios by name
        - in: query
          name: description
          schema:
            type: string
          description: Filter scenarios by description
        - in: query
          name: tags
          schema:
            type: string
          description: Filter scenarios by tags
        - in: query
          name: page
          schema:
            type: integer
            minimum: 0
          description: Page number
        - in: query
          name: page_size
          schema:
            type: integer
            maximum: 10000
            minimum: 1
            default: 100
          description: Number of elements by page
      responses:
        200:
          description: list of scenarios
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: number
                  next: {}
                  previous: {}
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        schema:
                          $ref: "#/components/schemas/ScenarioResult"

  /projects/{project_id}/studies/{study_id}/scenarios/{scenario_id}/:
    get:
      tags:
        - scenarios
      summary: Retrieve a scenario
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the scenario
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
        - in: path
          required: true
          name: scenario_id
          schema:
            type: integer
          description: scenario id you want to retrieve
      responses:
        200:
          description: The operational study info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScenarioResult"
    patch:
      tags:
        - scenarios
      summary: update a scenario
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the scenario
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
          description: study refered to the scenario
        - in: path
          required: true
          name: scenario_id
          schema:
            type: integer
          description: scenario you want to update
      requestBody:
        description: The fields you want to update
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScenarioRequest"
      responses:
        200:
          description: The scenario updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ScenarioResult"
    delete:
      tags:
        - scenarios
      summary: delete a scenario
      parameters:
        - in: path
          name: project_id
          schema:
            type: integer
          description: project id refered to the scenario
          required: true
        - in: path
          required: true
          name: study_id
          schema:
            type: integer
          description: study id refered to the scenario
        - in: path
          required: true
          name: scenario_id
          schema:
            type: integer
          description: scenario id you want to delete
      responses:
        204:
          description: No content

components:
  schemas:
    Infra:
      properties:
        id:
          type: integer
        name:
          type: string
        owner:
          type: string
          format: uuid
        created:
          type: string
          format: date-time
        modified:
          type: string
          format: date-time
    TrainScheduleResultData:
      properties:
        speeds:
          type: array
          minItems: 1
          items:
            type: object
            properties:
              time: { type: number, format: float }
              position: { type: number, format: float }
              speed: { type: number, format: float }
        head_positions:
          type: array
          minItems: 1
          items:
            type: array
            minItems: 1
            items:
              type: object
              properties:
                time: { type: number, format: float }
                position: { type: number, format: float }
        tail_positions:
          type: array
          minItems: 1
          items:
            type: array
            minItems: 1
            items:
              type: object
              properties:
                time: { type: number, format: float }
                position: { type: number, format: float }
        route_begin_occupancy:
          type: array
          minItems: 1
          items:
            type: array
            minItems: 1
            items:
              type: object
              properties:
                time: { type: number, format: float }
                position: { type: number, format: float }
        route_end_occupancy:
          type: array
          minItems: 1
          items:
            type: array
            minItems: 1
            items:
              type: object
              properties:
                time: { type: number, format: float }
                position: { type: number, format: float }
        stops:
          type: array
          items:
            type: object
            properties:
              id:
                type: number
                description: Can be null if it's not an operational point
              name:
                type: string
                description: Can be 'Unknown' if it's not an operational point
              time: { type: number, format: float }
              position: { type: number, format: float }
              duration: { type: number, format: float }
              line_code: { type: number }
              track_number: { type: number }
              line_name: { type: string }
              track_name: { type: string }
        route_aspects:
          type: array
          items:
            type: object
            properties:
              signal_id:
                type: string
                description: id of the updated signal
              route_id:
                type: string
                description: id of the affected route on the train path
              time_start:
                type: number
                format: float
                description: the aspect starts being displayed at this time
              time_end:
                type: number
                format: float
                description: the aspect stops being displayed at this time
              position_start:
                type: number
                format: float
                description: the route starts at this position on the train path
              position_end:
                type: number
                format: float
                description: the route ends at this position on the train path
              color:
                type: number
                format: float
                description: color of the aspect (Bits 24-31 are alpha, 16-23 are red, 8-15 are green, 0-7 are blue)
              blinking:
                type: boolean
                description: true if the signal is blinking
              aspect_label:
                type: string
                description: label of the new signal aspect
        signals:
          type: array
          items:
            type: object
            properties:
              signal_id: { type: integer }
              aspects:
                type: array
                items:
                  type: string
              geo_position:
                type: array
                items: { type: number, format: float }
                minItems: 2
                maxItems: 2
              schema_position:
                type: array
                items: { type: number, format: float }
                minItems: 2
                maxItems: 2
        mechanical_energy_consumed:
          type: number
          format: float
    TrainScheduleResult:
      properties:
        id:
          type: integer
        name:
          type: string
        labels:
          type: array
          items:
            type: string
        path:
          type: integer
          description: id of the path used for projection
        vmax:
          type: array
          minItems: 2
          items:
            type: object
            properties:
              position: { type: number }
              speed: { type: number }
        slopes:
          type: array
          minItems: 2
          items:
            type: object
            properties:
              position: { type: number }
              gradient: { type: number }
        curves:
          type: array
          minItems: 2
          items:
            type: object
            properties:
              position: { type: number }
              radius: { type: number }
        base:
          $ref: "#/components/schemas/TrainScheduleResultData"
        eco:
          oneOf:
            - $ref: "#/components/schemas/TrainScheduleResultData"
            - type: object
              properties:
                error: { type: string }
        modes_and_profiles:
          type: array
          items:
            description: The catenary mode and electrical profiles seen along the path. <mode_seen> and <profile_seen> are filled only if they differ from those used.
            type: array
            items:
              type: object
              properties:
                start:
                  type: number
                  format: double
                stop:
                  type: number
                  format: double
                mode_used:
                  type: string
                profile_used:
                  type: string
                  nullable: true
                mode_seen:
                  type: string
                  nullable: true
                profile_seen:
                  type: string
                  nullable: true

    PathQuery:
      properties:
        infra:
          type: integer
        rolling_stocks:
          type: array
          items:
            type: integer
        steps:
          type: array
          minItems: 2
          items:
            type: object
            properties:
              duration:
                type: number
                format: float
              waypoints:
                $ref: "#/components/schemas/Waypoint"
    Waypoint:
      type: array
      items:
        type: object
        properties:
          track_section:
            type: string
          geo_coordinate:
            type: array
            items: { type: number, format: float }
            minItems: 2
            maxItems: 2
    PathOPQuery:
      properties:
        infra:
          type: integer
        rolling_stocks:
          type: array
          items:
            type: integer
        steps:
          type: array
          minItems: 2
          items:
            type: object
            properties:
              duration:
                type: number
                format: float
              op_trigram:
                type: string
                minLength: 1
                maxLength: 3
                example: "PLY"
    STDCMRequest:
      properties:
        infra:
          type: integer
        rolling_stock:
          type: integer
        comfort:
          $ref: "#/components/schemas/Comfort"
        timetable:
          type: integer
          description: timetable ID
        start_time:
          type: number
          format: double
        end_time:
          type: number
          format: double
        start_points:
          type: array
          minimum: 1
          items:
            $ref: "#/components/schemas/Waypoint"
        end_points:
          type: array
          minimum: 1
          items:
            $ref: "#/components/schemas/Waypoint"
        maximum_departure_delay:
          type: number
          format: double
          description: By how long we can shift the departure time (s). Defaults to 2h if unspecified.
        maximum_relative_run_time:
          type: number
          format: double
          description: |
            How much longer the total run time can be compared to the shortest path on an empty timetable.
            Defaults to 2 if unspecified, meaning that the result can't take more than twice the minimum time.
        speed_limit_composition:
          type: string
          description: Train category for speed limits
        margin_before:
          type: number
          format: double
          description: |
            Margin of x seconds before the train passage, which means that the path used by the train should
            be free and available at least x seconds before its passage.
        margin_after:
          type: number
          format: double
          description: |
            Margin of y seconds after the train passage, which means that the path used by the train should
            be free and available at least y seconds after its passage.
        standard_allowance:
          $ref: "#/components/schemas/AllowanceValue"
    Path:
      properties:
        id:
          type: integer
        owner:
          type: string
          format: uuid
        created:
          type: string
          format: date-time
        geographic:
          type: object
          description: GeoJson format
          properties:
            coordinates:
              type: array
              items:
                type: array
                items:
                  type: number
                  format: float
            type:
              type: string
        schematic:
          type: object
          description: GeoJson format
          properties:
            coordinates:
              type: array
              items:
                type: array
                items:
                  type: number
                  format: float
            type:
              type: string
        slopes:
          description: Slopes on the path
          type: array
          items:
            type: object
            properties:
              gradient: { type: number, format: float }
              position: { type: number, format: float }
        curves:
          description: Curves on the path
          type: array
          items:
            type: object
            properties:
              radius: { type: number, format: float }
              position: { type: number, format: float }
        steps:
          type: array
          items:
            type: object
            properties:
              name: { type: string }
              suggestion: { type: boolean }
              duration: { type: number, format: float }
              track: { type: string }
              position: { type: number, format: float }
              sch:
                type: object
                properties:
                  coordinates:
                    type: array
                    items: { type: number, format: float }
                    minItems: 2
                    maxItems: 2
                  type: { type: string }
              geo:
                type: object
                properties:
                  coordinates:
                    type: array
                    items: { type: number, format: float }
                    minItems: 2
                    maxItems: 2
                  type: { type: string }
    RollingStock:
      allOf:
        - $ref: "#/components/schemas/LightRollingStock"
        - type: object
          properties:
            effort_curves:
              type: object
              properties:
                default_mode:
                  type: string
                modes:
                  type: object
                  additionalProperties:
                    type: object
                    properties:
                      curves:
                        type: array
                        items:
                          $ref: "#/components/schemas/ConditionalEffortCurve"
                      default_curve:
                        $ref: "#/components/schemas/EffortCurve"
                      is_electric:
                        type: boolean
    ConditionalEffortCurve:
      type: object
      properties:
        cond:
          type: object
          nullable: true
          properties:
            comfort:
              $ref: "#/components/schemas/Comfort"
        curve:
          $ref: "#/components/schemas/EffortCurve"
    Comfort:
      description: Train comfort that will be used for the simulation
      type: string
      enum: ["AC", "HEATING", "STANDARD"]
      default: "STANDARD"
    EffortCurve:
      type: object
      properties:
        speeds:
          type: array
          example: [0.0, 2.958, 46.719]
          minItems: 2
          items:
            type: number
            format: float
        max_efforts:
          type: array
          example: [23500.0, 23200.0, 21200.0]
          minItems: 2
          items:
            type: number
            format: float
    LightRollingStock:
      properties:
        id:
          type: number
        version:
          type: string
          example: "3.0"
        name:
          type: string
        length:
          type: number
          format: float
        max_speed:
          type: number
          format: float
        startup_time:
          type: number
          format: float
        startup_acceleration:
          type: number
          format: float
        comfort_acceleration:
          type: number
          format: float
        gamma:
          type: object
          properties:
            type:
              type: string
              enum: ["CONST", "MAX"]
            value:
              type: number
              format: float
        inertia_coefficient:
          type: number
          format: float
        features:
          type: array
          items:
            type: string
        mass:
          type: number
          format: float
        rolling_resistance:
          type: object
          properties:
            A:
              type: number
            B:
              type: number
            C:
              type: number
            type:
              type: string
              enum: ["davis"]
        loading_gauge:
          type: string
          enum:
            - "G1"
            - "G2"
            - "GA"
            - "GB"
            - "GB1"
            - "GC"
            - "FR3.3"
            - "FR3.3/GB/G2"
            - "GLOTT"
        effort_curves:
          type: object
          properties:
            default_mode:
              type: string
            modes:
              type: object
              additionalProperties:
                type: object
                properties:
                  is_electric:
                    type: boolean
        metadata:
          type: object
          example:
            detail: "BB 7200"
            family: "LOCOMOTIVES"
            grouping: "Locomotives électriques courant continu"
            number: "1"
            reference: "7200"
            series: "BB 7200"
            subseries: "GV"
            type: "Locomotives électriques"
            unit: "US"
        liveries:
          type: array
          items:
            type: object
            properties:
              id:
                type: number
              name:
                type: string
    TrainSchedule:
      allOf:
        - type: object
          properties:
            id:
              type: integer
        - $ref: "#/components/schemas/WritableTrainSchedule"
    StandaloneSimulationParameters:
      properties:
        timetable:
          type: integer
        path:
          type: integer
        schedules:
          type: array
          minItems: 1
          items:
            type: object
            properties:
              train_name:
                type: string
              rolling_stock:
                type: integer
              departure_time:
                type: number
                format: float
              initial_speed:
                type: number
                format: float
              labels:
                type: array
                items:
                  type: string
              allowances:
                type: array
                items:
                  $ref: "#/components/schemas/Allowance"
              speed_limit_composition:
                description: Train category for speed limits
                type: string
              comfort:
                $ref: "#/components/schemas/Comfort"
              options:
                allOf:
                  - $ref: "#/components/schemas/TrainScheduleOptions"
                nullable: true
    WritableTrainSchedule:
      properties:
        train_name:
          type: string
        timetable:
          type: integer
        rolling_stock:
          type: integer
        departure_time:
          type: number
          format: float
        path:
          type: integer
        initial_speed:
          type: number
          format: float
        labels:
          type: array
          items:
            type: string
        allowances:
          type: array
          items:
            $ref: "#/components/schemas/Allowance"
        speed_limit_composition:
          description: Train category for speed limits
          type: string
        comfort:
          $ref: "#/components/schemas/Comfort"
        options:
          allOf:
            - $ref: "#/components/schemas/TrainScheduleOptions"
          nullable: true
    TrainScheduleOptions:
      description: Options for the standalone simulation
      type: object
      properties:
        ignore_electrical_profiles:
          type: boolean
          nullable: true
    Allowance:
      oneOf:
        - $ref: "#/components/schemas/EngineeringAllowance"
        - $ref: "#/components/schemas/StandardAllowance"
      discriminator:
        propertyName: allowance_type
    StandardAllowance:
      properties:
        allowance_type:
          type: string
          enum: ["standard"]
        default_value:
          $ref: "#/components/schemas/AllowanceValue"
        ranges:
          type: array
          items:
            $ref: "#/components/schemas/RangeAllowance"
        distribution:
          type: string
          enum: ["MARECO", "LINEAR"]
        capacity_speed_limit:
          type: number
          format: double
    EngineeringAllowance:
      allOf:
        - type: object
          properties:
            allowance_type:
              type: string
              enum: ["engineering"]
            distribution:
              type: string
              enum: ["MARECO", "LINEAR"]
            capacity_speed_limit:
              type: number
              format: double
        - $ref: "#/components/schemas/RangeAllowance"
    RangeAllowance:
      properties:
        begin_position:
          type: number
        end_position:
          type: number
          example: 1000.0
        value:
          $ref: "#/components/schemas/AllowanceValue"
    AllowanceValue:
      oneOf:
        - $ref: "#/components/schemas/AllowanceTimePerDistanceValue"
        - $ref: "#/components/schemas/AllowanceTimeValue"
        - $ref: "#/components/schemas/AllowancePercentValue"
      discriminator:
        propertyName: value_type
    AllowanceTimePerDistanceValue:
      properties:
        value_type:
          type: string
          enum: ["time_per_distance"]
        minutes:
          type: number
          example: 5.0
          description: Minutes per 100k
    AllowanceTimeValue:
      properties:
        value_type:
          type: string
          enum: ["time"]
        seconds:
          type: number
          example: 180.0
    AllowancePercentValue:
      properties:
        value_type:
          type: string
          enum: ["percentage"]
        percentage:
          type: number
          example: 15.0
    ProjectRequest:
      properties:
        name:
          type: string
          maxLength: 128
        objectives:
          type: string
          maxLength: 4096
        description:
          type: string
          maxLength: 1024
        funders:
          type: array
          items:
            type: string
          maxLength: 255
        budget:
          type: integer
        image:
          type: object
        tags:
          type: array
          items:
            type: string
            maxLength: 255
      required:
        - "name"
    ProjectResult:
      properties:
        id:
          type: integer
        name:
          type: string
        objectives:
          type: string
        description:
          type: string
        funders:
          type: array
          items:
            type: string
        budget:
          type: integer
        image_url:
          type: string
          description: the image url
        creation_date:
          type: string
          format: date-time
        last_modification:
          type: string
          format: date-time
        studies:
          type: array
          items:
            type: integer
        tags:
          type: array
          items:
            type: string
    StudyRequest:
      properties:
        name:
          type: string
          maxLength: 128
        service_code:
          type: string
          maxLength: 128
        business_code:
          type: string
          maxLength: 128
        description:
          type: string
          maxLength: 1024
        budget:
          type: integer
        tags:
          type: array
          items:
            type: string
            maxLength: 255
        start_date:
          type: string
          format: date-time
        expected_end_date:
          type: string
          format: date-time
        actual_end_date:
          type: string
          format: date-time
        state:
          type: string
          enum: ["started", "inProgress", "finish"]
        type:
          type: string
          enum:
            [
              "timeTables",
              "flowRate",
              "parkSizing",
              "garageRequirement",
              "operationOrSizing",
              "operability",
              "strategicPlanning",
              "chartStability",
              "disturbanceTests",
            ]
      required:
        - "name"
    StudyResult:
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        budget:
          type: integer
        service_code:
          type: string
        business_code:
          type: string
        creation_date:
          type: string
          format: date-time
        last_modification:
          type: string
          format: date-time
        scenarios:
          type: array
          items:
            type: integer
        start_date_study:
          type: string
          format: date-time
        expected_end_date_study:
          type: string
          format: date-time
        actual_end_date_study:
          type: string
          format: date-time
        state:
          type: string
          enum: ["started", "inProgress", "finish"]
        type:
          type: string
          enum:
            [
              "timeTables",
              "flowRate",
              "parkSizing",
              "garageRequirement",
              "operationOrSizing",
              "operability",
              "strategicPlanning",
              "chartStability",
              "disturbanceTests",
            ]
    ScenarioRequest:
      properties:
        name:
          type: string
          maxLength: 128
        description:
          type: string
          maxLength: 1024
        tags:
          type: array
          items:
            type: string
            maxLength: 255
        infra:
          type: integer
        electrical_profile_set:
          type: number
          nullable: true
          description: Electrical profile set id (if any)
      required:
        - "name"
    ScenarioResult:
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
          items:
            type: string
        tags:
          type: array
          items:
            type: string
        infra:
          type: integer
        infra_name:
          type: string
        electrical_profile_set:
          type: integer
          nullable: true
        electrical_profile_set_name:
          type: string
          nullable: true
        creation_date:
          type: string
          format: date-time
        last_modification:
          type: string
          format: date-time
        timetable:
          type: integer
        trains_count:
          type: integer
        trains_schedules:
          type: array
          items:
            type: string
